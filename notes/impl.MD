### 文件
每一个数据库由文件夹里的一系列文件表示，有如下文件：
- Log文件：存储着最近的升级信息。每次升级添加到当前Log文件，若文件达到4MB（预设），则转为分类表并生成新的Log文件
- memtable：当前的log文件保存在内存中的memtable中，每次读操作会查看此表。

### 分类表(Sorted tables)
分类表（\*.ldb)存储着一系列由键值排序的入口，每个入口要么是键的值，要么是被删除的标记。分类表构成一系列的层级。从log文件新生成的分类表放置在0等级。当新文件的数量超过一定数量（4），所有的新文件合并生成等级1文件（2MB大小）。
0等级的文件包含交错的键。高等级容量大，当低等级超过容量时，向高等级迁移。

#### 清单(Manifest)
清单文件列出了组成每个等级的分类表，对应的键范围和其它重要的数据。当数据库再次打开时就创建新的清单文件。清单文件是log格式，服务状态的改变添加到这个log里。

#### 当前(Current)
当前包含着最新的清单文件

#### 信息log(Info logs)
信息文件打印到LOG和LOG.old

### 等级0
当log文件超过一定大小，则创建新的memtable和log文件，未来的更新都放在新文件内：将之前的memtable写到sstable，丢弃memtable，删掉老的log文件和memtable。将新的sstable添加到等级0

### 压缩
当等级L超过它的极限，我们就对其进行压缩。压缩从等级L中挑出一个文件和等级L+1中挑出重叠的文件。如果L中文件仅和L+1中的一个文件部分重叠，L+1中的文件被用来作为输入，并且在压缩后丢弃。除外，等级0比较特殊（文件会重叠），等级0的压缩可以挑选多于1的文件。
压缩合并所选择的文件来生成L+1等级的文件。当当前输出文件的键范围超出了10倍的L+2级别则专项新的输出文件。最后一个原则确保了L+1级在稍后的压缩中不会从L+2中选择过多的数据（L+1级比L级大十倍）。
压缩会在某一层里循环，即键值不重叠
压缩迭起重复的值的删除标志。

#### 时间
等级0最大读取1MB，最坏情况下等级1读取10MB（待学习）

### 文件的垃圾回收
`DeleteObsoleteFiles()`在每次压缩和恢复的末尾被调用，函数找到数据库内所有文件的名字。删除所有不在当前log文件的log文件，删除所有不被等级引用和不是压缩的输出的表文件。
